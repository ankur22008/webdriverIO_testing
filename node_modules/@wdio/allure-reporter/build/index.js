"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _reporter = _interopRequireDefault(require("@wdio/reporter"));

var _allureJsCommons = _interopRequireDefault(require("allure-js-commons"));

var _step = _interopRequireDefault(require("allure-js-commons/beans/step"));

var _utils = require("./utils");

var _constants = require("./constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class AllureReporter extends _reporter.default {
  constructor(options) {
    super(options);
    this.config = {};
    this.allure = new _allureJsCommons.default();
    this.allure.setOptions({
      targetDir: options.outputDir || 'allure-results'
    });
    this.registerListeners();
  }

  registerListeners() {
    process.on(_constants.events.addFeature, this.addFeature.bind(this));
    process.on(_constants.events.addStory, this.addStory.bind(this));
    process.on(_constants.events.addSeverity, this.addSeverity.bind(this));
    process.on(_constants.events.addIssue, this.addIssue.bind(this));
    process.on(_constants.events.addTestId, this.addTestId.bind(this));
    process.on(_constants.events.addEnvironment, this.addEnvironment.bind(this));
    process.on(_constants.events.addAttachment, this.addAttachment.bind(this));
    process.on(_constants.events.addDescription, this.addDescription.bind(this));
    process.on(_constants.events.addStep, this.addStep.bind(this));
    process.on(_constants.events.addArgument, this.addArgument.bind(this));
  }

  onRunnerStart(runner) {
    this.config = runner.config;
    this.isMultiremote = runner.isMultiremote || false;
  }

  onSuiteStart(suite) {
    const currentSuite = this.allure.getCurrentSuite();
    const prefix = currentSuite ? currentSuite.name + ' ' : '';
    this.allure.startSuite(prefix + suite.title);
  }

  onSuiteEnd() {
    this.allure.endSuite();
  }

  onTestStart(test) {
    this.allure.startCase(test.title);
    const currentTest = this.allure.getCurrentTest();
    const {
      browserName,
      deviceName
    } = this.config.capabilities;
    const targetName = browserName || deviceName || test.cid;
    const version = this.config.capabilities.version || this.config.capabilities.platformVersion || '';
    const paramName = deviceName ? 'device' : 'browser';
    const paramValue = version ? `${targetName}-${version}` : targetName;
    currentTest.addParameter('argument', paramName, paramValue); // Allure analytics labels. See https://github.com/allure-framework/allure2/blob/master/Analytics.md

    currentTest.addLabel('language', 'javascript');
    currentTest.addLabel('framework', 'wdio');
    currentTest.addLabel('thread', test.cid);
  }

  onTestPass() {
    this.allure.endCase(_constants.testStatuses.PASSED);
  }

  onTestFail(test) {
    if (!this.isAnyTestRunning()) {
      this.allure.startCase(test.title);
    } else {
      this.allure.getCurrentTest().name = test.title;
    }

    const status = (0, _utils.getTestStatus)(test, this.config);

    while (this.allure.getCurrentSuite().currentStep instanceof _step.default) {
      this.allure.endStep(status);
    }

    this.allure.endCase(status, test.error);
  }

  onTestSkip(test) {
    if (this.allure.getCurrentTest() && this.allure.getCurrentTest().status !== _constants.testStatuses.PENDING) {
      this.allure.endCase(_constants.testStatuses.PENDING);
    } else {
      this.allure.pendingCase(test.title);
    }
  }

  onBeforeCommand(command) {
    if (!this.isAnyTestRunning()) {
      return;
    }

    if (this.options.disableWebdriverStepsReporting || this.isMultiremote) {
      return;
    }

    this.allure.startStep(`${command.method} ${command.endpoint}`);

    if (!(0, _utils.isEmpty)(command.body)) {
      this.dumpJSON('Request', command.body);
    }
  }

  onAfterCommand(command) {
    if (!this.isAnyTestRunning() || this.isMultiremote) {
      return;
    }

    const {
      disableWebdriverStepsReporting,
      disableWebdriverScreenshotsReporting
    } = this.options;

    if (this.isScreenshotCommand(command) && command.result.value) {
      if (!disableWebdriverScreenshotsReporting) {
        this.allure.addAttachment('Screenshot', Buffer.from(command.result.value, 'base64'));
      }
    }

    if (!disableWebdriverStepsReporting) {
      if (command.result && command.result.value && !this.isScreenshotCommand(command)) {
        this.dumpJSON('Response', command.result.value);
      }

      this.allure.endStep(_constants.testStatuses.PASSED);
    }
  }

  onHookStart(hook) {
    if (!this.allure.getCurrentSuite() || (0, _utils.ignoredHooks)(hook.title)) {
      return false;
    }

    this.allure.startCase(hook.title);
  }

  onHookEnd(hook) {
    if (!this.allure.getCurrentSuite() || (0, _utils.ignoredHooks)(hook.title)) {
      return false;
    }

    this.allure.endCase(_constants.testStatuses.PASSED);

    if (this.allure.getCurrentTest().steps.length === 0) {
      this.allure.getCurrentSuite().testcases.pop();
    }
  }

  addStory({
    storyName
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addLabel('story', storyName);
  }

  addFeature({
    featureName
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addLabel('feature', featureName);
  }

  addSeverity({
    severity
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addLabel('severity', severity);
  }

  addIssue({
    issue
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addLabel('issue', issue);
  }

  addTestId({
    testId
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addLabel('testId', testId);
  }

  addEnvironment({
    name,
    value
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addParameter('environment-variable', name, value);
  }

  addDescription({
    description,
    type
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.setDescription(description, type);
  }

  addAttachment({
    name,
    content,
    type = 'text/plain'
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    if (type === 'application/json') {
      this.dumpJSON(name, content);
    } else {
      this.allure.addAttachment(name, Buffer.from(content), type);
    }
  }

  addStep({
    step
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    this.allure.startStep(step.title);

    if (step.attachment) {
      this.addAttachment(step.attachment);
    }

    this.allure.endStep(step.status);
  }

  addArgument({
    name,
    value
  }) {
    if (!this.isAnyTestRunning()) {
      return false;
    }

    const test = this.allure.getCurrentTest();
    test.addParameter('argument', name, value);
  }

  isAnyTestRunning() {
    return this.allure.getCurrentSuite() && this.allure.getCurrentTest();
  }

  isScreenshotCommand(command) {
    const isScrenshotEndpoint = /\/session\/[^/]*\/screenshot/;
    return isScrenshotEndpoint.test(command.endpoint);
  }

  dumpJSON(name, json) {
    this.allure.addAttachment(name, JSON.stringify(json, null, 2), 'application/json');
  }
  /**
   * Assign feature to test
   * @param {(string)} featureName - feature name or an array of names
   */


}

_defineProperty(AllureReporter, "addFeature", featureName => {
  (0, _utils.tellReporter)(_constants.events.addFeature, {
    featureName
  });
});

_defineProperty(AllureReporter, "addSeverity", severity => {
  (0, _utils.tellReporter)(_constants.events.addSeverity, {
    severity
  });
});

_defineProperty(AllureReporter, "addIssue", issue => {
  (0, _utils.tellReporter)(_constants.events.addIssue, {
    issue
  });
});

_defineProperty(AllureReporter, "addTestId", testId => {
  (0, _utils.tellReporter)(_constants.events.addTestId, {
    testId
  });
});

_defineProperty(AllureReporter, "addStory", storyName => {
  (0, _utils.tellReporter)(_constants.events.addStory, {
    storyName
  });
});

_defineProperty(AllureReporter, "addEnvironment", (name, value) => {
  (0, _utils.tellReporter)(_constants.events.addEnvironment, {
    name,
    value
  });
});

_defineProperty(AllureReporter, "addDescription", (description, type) => {
  (0, _utils.tellReporter)(_constants.events.addDescription, {
    description,
    type
  });
});

_defineProperty(AllureReporter, "addAttachment", (name, content, type = 'text/plain') => {
  (0, _utils.tellReporter)(_constants.events.addAttachment, {
    name,
    content,
    type
  });
});

_defineProperty(AllureReporter, "addStep", (title, {
  content,
  name = 'attachment'
}, status = _constants.stepStatuses.PASSED) => {
  if (!Object.values(_constants.stepStatuses).includes(status)) {
    throw new Error(`Step status must be ${Object.values(_constants.stepStatuses).join(' or ')}. You tried to set "${status}"`);
  }

  const step = {
    title,
    attachment: {
      content,
      name
    },
    status
  };
  (0, _utils.tellReporter)(_constants.events.addStep, {
    step
  });
});

_defineProperty(AllureReporter, "addArgument", (name, value) => {
  (0, _utils.tellReporter)(_constants.events.addArgument, {
    name,
    value
  });
});

var _default = AllureReporter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJBbGx1cmVSZXBvcnRlciIsIldESU9SZXBvcnRlciIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImNvbmZpZyIsImFsbHVyZSIsIkFsbHVyZSIsInNldE9wdGlvbnMiLCJ0YXJnZXREaXIiLCJvdXRwdXREaXIiLCJyZWdpc3Rlckxpc3RlbmVycyIsInByb2Nlc3MiLCJvbiIsImV2ZW50cyIsImFkZEZlYXR1cmUiLCJhZGRTdG9yeSIsImFkZFNldmVyaXR5IiwiYWRkSXNzdWUiLCJhZGRUZXN0SWQiLCJhZGRFbnZpcm9ubWVudCIsImFkZEF0dGFjaG1lbnQiLCJhZGREZXNjcmlwdGlvbiIsImFkZFN0ZXAiLCJhZGRBcmd1bWVudCIsIm9uUnVubmVyU3RhcnQiLCJydW5uZXIiLCJpc011bHRpcmVtb3RlIiwib25TdWl0ZVN0YXJ0Iiwic3VpdGUiLCJjdXJyZW50U3VpdGUiLCJnZXRDdXJyZW50U3VpdGUiLCJwcmVmaXgiLCJuYW1lIiwic3RhcnRTdWl0ZSIsInRpdGxlIiwib25TdWl0ZUVuZCIsImVuZFN1aXRlIiwib25UZXN0U3RhcnQiLCJ0ZXN0Iiwic3RhcnRDYXNlIiwiY3VycmVudFRlc3QiLCJnZXRDdXJyZW50VGVzdCIsImJyb3dzZXJOYW1lIiwiZGV2aWNlTmFtZSIsImNhcGFiaWxpdGllcyIsInRhcmdldE5hbWUiLCJjaWQiLCJ2ZXJzaW9uIiwicGxhdGZvcm1WZXJzaW9uIiwicGFyYW1OYW1lIiwicGFyYW1WYWx1ZSIsImFkZFBhcmFtZXRlciIsImFkZExhYmVsIiwib25UZXN0UGFzcyIsImVuZENhc2UiLCJ0ZXN0U3RhdHVzZXMiLCJQQVNTRUQiLCJvblRlc3RGYWlsIiwiaXNBbnlUZXN0UnVubmluZyIsInN0YXR1cyIsImN1cnJlbnRTdGVwIiwiU3RlcCIsImVuZFN0ZXAiLCJlcnJvciIsIm9uVGVzdFNraXAiLCJQRU5ESU5HIiwicGVuZGluZ0Nhc2UiLCJvbkJlZm9yZUNvbW1hbmQiLCJjb21tYW5kIiwiZGlzYWJsZVdlYmRyaXZlclN0ZXBzUmVwb3J0aW5nIiwic3RhcnRTdGVwIiwibWV0aG9kIiwiZW5kcG9pbnQiLCJib2R5IiwiZHVtcEpTT04iLCJvbkFmdGVyQ29tbWFuZCIsImRpc2FibGVXZWJkcml2ZXJTY3JlZW5zaG90c1JlcG9ydGluZyIsImlzU2NyZWVuc2hvdENvbW1hbmQiLCJyZXN1bHQiLCJ2YWx1ZSIsIkJ1ZmZlciIsImZyb20iLCJvbkhvb2tTdGFydCIsImhvb2siLCJvbkhvb2tFbmQiLCJzdGVwcyIsImxlbmd0aCIsInRlc3RjYXNlcyIsInBvcCIsInN0b3J5TmFtZSIsImZlYXR1cmVOYW1lIiwic2V2ZXJpdHkiLCJpc3N1ZSIsInRlc3RJZCIsImRlc2NyaXB0aW9uIiwidHlwZSIsInNldERlc2NyaXB0aW9uIiwiY29udGVudCIsInN0ZXAiLCJhdHRhY2htZW50IiwiaXNTY3JlbnNob3RFbmRwb2ludCIsImpzb24iLCJKU09OIiwic3RyaW5naWZ5Iiwic3RlcFN0YXR1c2VzIiwiT2JqZWN0IiwidmFsdWVzIiwiaW5jbHVkZXMiLCJFcnJvciIsImpvaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQSxNQUFNQSxjQUFOLFNBQTZCQyxpQkFBN0IsQ0FBMEM7QUFDdENDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBRCxFQUFVO0FBQ2pCLFVBQU1BLE9BQU47QUFDQSxTQUFLQyxNQUFMLEdBQWMsRUFBZDtBQUNBLFNBQUtDLE1BQUwsR0FBYyxJQUFJQyx3QkFBSixFQUFkO0FBQ0EsU0FBS0QsTUFBTCxDQUFZRSxVQUFaLENBQXVCO0FBQUNDLE1BQUFBLFNBQVMsRUFBRUwsT0FBTyxDQUFDTSxTQUFSLElBQXFCO0FBQWpDLEtBQXZCO0FBQ0EsU0FBS0MsaUJBQUw7QUFDSDs7QUFFREEsRUFBQUEsaUJBQWlCLEdBQUc7QUFDaEJDLElBQUFBLE9BQU8sQ0FBQ0MsRUFBUixDQUFXQyxrQkFBT0MsVUFBbEIsRUFBZ0MsS0FBS0Es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QUFBT2lFLElBQUFBLE9BQVA7QUFBZ0JGLElBQUFBO0FBQWhCLEdBQW5DO0FBQ0gsQzs7Z0JBeFRDL0YsYyxhQWlVZSxDQUFDa0MsS0FBRCxFQUFRO0FBQUMrRCxFQUFBQSxPQUFEO0FBQVVqRSxFQUFBQSxJQUFJLEdBQUc7QUFBakIsQ0FBUixFQUF3QzJCLE1BQU0sR0FBRzZDLHdCQUFhaEQsTUFBOUQsS0FBeUU7QUFDdEYsTUFBSSxDQUFDaUQsTUFBTSxDQUFDQyxNQUFQLENBQWNGLHVCQUFkLEVBQTRCRyxRQUE1QixDQUFxQ2hELE1BQXJDLENBQUwsRUFBbUQ7QUFDL0MsVUFBTSxJQUFJaUQsS0FBSixDQUFXLHVCQUFzQkgsTUFBTSxDQUFDQyxNQUFQLENBQWNGLHVCQUFkLEVBQTRCSyxJQUE1QixDQUFpQyxNQUFqQyxDQUF5Qyx1QkFBc0JsRCxNQUFPLEdBQXZHLENBQU47QUFDSDs7QUFFRCxRQUFNdUMsSUFBSSxHQUFHO0FBQ1RoRSxJQUFBQSxLQURTO0FBRVRpRSxJQUFBQSxVQUFVLEVBQUU7QUFDUkYsTUFBQUEsT0FEUTtBQUVSakUsTUFBQUE7QUFGUSxLQUZIO0FBTVQyQixJQUFBQTtBQU5TLEdBQWI7QUFRQSwyQkFBYTlDLGtCQUFPUyxPQUFwQixFQUE2QjtBQUFDNEUsSUFBQUE7QUFBRCxHQUE3QjtBQUNILEM7O2dCQS9VQ2xHLGMsaUJBc1ZtQixDQUFDZ0MsSUFBRCxFQUFPK0MsS0FBUCxLQUFpQjtBQUNsQywyQkFBYWxFLGtCQUFPVSxXQUFwQixFQUFpQztBQUFDUyxJQUFBQSxJQUFEO0FBQU8rQyxJQUFBQTtBQUFQLEdBQWpDO0FBQ0gsQzs7ZUFHVS9FLGMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgV0RJT1JlcG9ydGVyIGZyb20gJ0B3ZGlvL3JlcG9ydGVyJ1xuaW1wb3J0IEFsbHVyZSBmcm9tICdhbGx1cmUtanMtY29tbW9ucydcbmltcG9ydCBTdGVwIGZyb20gJ2FsbHVyZS1qcy1jb21tb25zL2JlYW5zL3N0ZXAnXG5pbXBvcnQge2dldFRlc3RTdGF0dXMsIGlnbm9yZWRIb29rcywgaXNFbXB0eSwgdGVsbFJlcG9ydGVyfSBmcm9tICcuL3V0aWxzJ1xuaW1wb3J0IHtldmVudHMsIHN0ZXBTdGF0dXNlcywgdGVzdFN0YXR1c2VzfSBmcm9tICcuL2NvbnN0YW50cydcblxuY2xhc3MgQWxsdXJlUmVwb3J0ZXIgZXh0ZW5kcyBXRElPUmVwb3J0ZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucylcbiAgICAgICAgdGhpcy5jb25maWcgPSB7fVxuICAgICAgICB0aGlzLmFsbHVyZSA9IG5ldyBBbGx1cmUoKVxuICAgICAgICB0aGlzLmFsbHVyZS5zZXRPcHRpb25zKHt0YXJnZXREaXI6IG9wdGlvbnMub3V0cHV0RGlyIHx8ICdhbGx1cmUtcmVzdWx0cyd9KVxuICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdGVuZXJzKClcbiAgICB9XG5cbiAgICByZWdpc3Rlckxpc3RlbmVycygpIHtcbiAgICAgICAgcHJvY2Vzcy5vbihldmVudHMuYWRkRmVhdHVyZSwgOjp0aGlzLmFkZEZlYXR1cmUpXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZFN0b3J5LCA6OnRoaXMuYWRkU3RvcnkpXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZFNldmVyaXR5LCA6OnRoaXMuYWRkU2V2ZXJpdHkpXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZElzc3VlLCA6OnRoaXMuYWRkSXNzdWUpXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZFRlc3RJZCwgOjp0aGlzLmFkZFRlc3RJZClcbiAgICAgICAgcHJvY2Vzcy5vbihldmVudHMuYWRkRW52aXJvbm1lbnQsIDo6dGhpcy5hZGRFbnZpcm9ubWVudClcbiAgICAgICAgcHJvY2Vzcy5vbihldmVudHMuYWRkQXR0YWNobWVudCwgOjp0aGlzLmFkZEF0dGFjaG1lbnQpXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZERlc2NyaXB0aW9uLCA6OnRoaXMuYWRkRGVzY3JpcHRpb24pXG4gICAgICAgIHByb2Nlc3Mub24oZXZlbnRzLmFkZFN0ZXAsIDo6dGhpcy5hZGRTdGVwKVxuICAgICAgICBwcm9jZXNzLm9uKGV2ZW50cy5hZGRBcmd1bWVudCwgOjp0aGlzLmFkZEFyZ3VtZW50KVxuICAgIH1cblxuICAgIG9uUnVubmVyU3RhcnQocnVubmVyKSB7XG4gICAgICAgIHRoaXMuY29uZmlnID0gcnVubmVyLmNvbmZpZ1xuICAgICAgICB0aGlzLmlzTXVsdGlyZW1vdGUgPSBydW5uZXIuaXNNdWx0aXJlbW90ZSB8fCBmYWxzZVxuICAgIH1cblxuICAgIG9uU3VpdGVTdGFydChzdWl0ZSkge1xuICAgICAgICBjb25zdCBjdXJyZW50U3VpdGUgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50U3VpdGUoKVxuICAgICAgICBjb25zdCBwcmVmaXggPSBjdXJyZW50U3VpdGUgPyBjdXJyZW50U3VpdGUubmFtZSArICcgJyA6ICcnXG4gICAgICAgIHRoaXMuYWxsdXJlLnN0YXJ0U3VpdGUocHJlZml4ICsgc3VpdGUudGl0bGUpXG4gICAgfVxuXG4gICAgb25TdWl0ZUVuZCgpIHtcbiAgICAgICAgdGhpcy5hbGx1cmUuZW5kU3VpdGUoKVxuICAgIH1cblxuICAgIG9uVGVzdFN0YXJ0KHRlc3QpIHtcbiAgICAgICAgdGhpcy5hbGx1cmUuc3RhcnRDYXNlKHRlc3QudGl0bGUpXG5cbiAgICAgICAgY29uc3QgY3VycmVudFRlc3QgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG5cbiAgICAgICAgY29uc3QgeyBicm93c2VyTmFtZSwgZGV2aWNlTmFtZSB9ID0gdGhpcy5jb25maWcuY2FwYWJpbGl0aWVzXG4gICAgICAgIGNvbnN0IHRhcmdldE5hbWUgPSBicm93c2VyTmFtZSB8fCBkZXZpY2VOYW1lIHx8IHRlc3QuY2lkXG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSB0aGlzLmNvbmZpZy5jYXBhYmlsaXRpZXMudmVyc2lvbiB8fCB0aGlzLmNvbmZpZy5jYXBhYmlsaXRpZXMucGxhdGZvcm1WZXJzaW9uIHx8ICcnXG4gICAgICAgIGNvbnN0IHBhcmFtTmFtZSA9IGRldmljZU5hbWUgPyAnZGV2aWNlJyA6ICdicm93c2VyJ1xuICAgICAgICBjb25zdCBwYXJhbVZhbHVlID0gdmVyc2lvbiA/IGAke3RhcmdldE5hbWV9LSR7dmVyc2lvbn1gIDogdGFyZ2V0TmFtZVxuICAgICAgICBjdXJyZW50VGVzdC5hZGRQYXJhbWV0ZXIoJ2FyZ3VtZW50JywgcGFyYW1OYW1lLCBwYXJhbVZhbHVlKVxuXG4gICAgICAgIC8vIEFsbHVyZSBhbmFseXRpY3MgbGFiZWxzLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2FsbHVyZS1mcmFtZXdvcmsvYWxsdXJlMi9ibG9iL21hc3Rlci9BbmFseXRpY3MubWRcbiAgICAgICAgY3VycmVudFRlc3QuYWRkTGFiZWwoJ2xhbmd1YWdlJywgJ2phdmFzY3JpcHQnKVxuICAgICAgICBjdXJyZW50VGVzdC5hZGRMYWJlbCgnZnJhbWV3b3JrJywgJ3dkaW8nKVxuICAgICAgICBjdXJyZW50VGVzdC5hZGRMYWJlbCgndGhyZWFkJywgdGVzdC5jaWQpXG4gICAgfVxuXG4gICAgb25UZXN0UGFzcygpIHtcbiAgICAgICAgdGhpcy5hbGx1cmUuZW5kQ2FzZSh0ZXN0U3RhdHVzZXMuUEFTU0VEKVxuICAgIH1cblxuICAgIG9uVGVzdEZhaWwodGVzdCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpKSB7XG4gICAgICAgICAgICB0aGlzLmFsbHVyZS5zdGFydENhc2UodGVzdC50aXRsZSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWxsdXJlLmdldEN1cnJlbnRUZXN0KCkubmFtZSA9IHRlc3QudGl0bGVcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0YXR1cyA9IGdldFRlc3RTdGF0dXModGVzdCwgdGhpcy5jb25maWcpXG4gICAgICAgIHdoaWxlICh0aGlzLmFsbHVyZS5nZXRDdXJyZW50U3VpdGUoKS5jdXJyZW50U3RlcCBpbnN0YW5jZW9mIFN0ZXApIHtcbiAgICAgICAgICAgIHRoaXMuYWxsdXJlLmVuZFN0ZXAoc3RhdHVzKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbGx1cmUuZW5kQ2FzZShzdGF0dXMsIHRlc3QuZXJyb3IpXG4gICAgfVxuXG4gICAgb25UZXN0U2tpcCh0ZXN0KSB7XG4gICAgICAgIGlmICh0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpICYmIHRoaXMuYWxsdXJlLmdldEN1cnJlbnRUZXN0KCkuc3RhdHVzICE9PSB0ZXN0U3RhdHVzZXMuUEVORElORykge1xuICAgICAgICAgICAgdGhpcy5hbGx1cmUuZW5kQ2FzZSh0ZXN0U3RhdHVzZXMuUEVORElORylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYWxsdXJlLnBlbmRpbmdDYXNlKHRlc3QudGl0bGUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkJlZm9yZUNvbW1hbmQoY29tbWFuZCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZVdlYmRyaXZlclN0ZXBzUmVwb3J0aW5nIHx8IHRoaXMuaXNNdWx0aXJlbW90ZSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFsbHVyZS5zdGFydFN0ZXAoYCR7Y29tbWFuZC5tZXRob2R9ICR7Y29tbWFuZC5lbmRwb2ludH1gKVxuXG4gICAgICAgIGlmICghaXNFbXB0eShjb21tYW5kLmJvZHkpKSB7XG4gICAgICAgICAgICB0aGlzLmR1bXBKU09OKCdSZXF1ZXN0JywgY29tbWFuZC5ib2R5KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25BZnRlckNvbW1hbmQoY29tbWFuZCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpIHx8IHRoaXMuaXNNdWx0aXJlbW90ZSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7ZGlzYWJsZVdlYmRyaXZlclN0ZXBzUmVwb3J0aW5nLCBkaXNhYmxlV2ViZHJpdmVyU2NyZWVuc2hvdHNSZXBvcnRpbmd9ID0gdGhpcy5vcHRpb25zXG4gICAgICAgIGlmICh0aGlzLmlzU2NyZWVuc2hvdENvbW1hbmQoY29tbWFuZCkgJiYgY29tbWFuZC5yZXN1bHQudmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghZGlzYWJsZVdlYmRyaXZlclNjcmVlbnNob3RzUmVwb3J0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGx1cmUuYWRkQXR0YWNobWVudCgnU2NyZWVuc2hvdCcsIEJ1ZmZlci5mcm9tKGNvbW1hbmQucmVzdWx0LnZhbHVlLCAnYmFzZTY0JykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaXNhYmxlV2ViZHJpdmVyU3RlcHNSZXBvcnRpbmcpIHtcbiAgICAgICAgICAgIGlmIChjb21tYW5kLnJlc3VsdCAmJiBjb21tYW5kLnJlc3VsdC52YWx1ZSAmJiAhdGhpcy5pc1NjcmVlbnNob3RDb21tYW5kKGNvbW1hbmQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kdW1wSlNPTignUmVzcG9uc2UnLCBjb21tYW5kLnJlc3VsdC52YWx1ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYWxsdXJlLmVuZFN0ZXAodGVzdFN0YXR1c2VzLlBBU1NFRClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uSG9va1N0YXJ0KGhvb2spIHtcbiAgICAgICAgaWYgKCF0aGlzLmFsbHVyZS5nZXRDdXJyZW50U3VpdGUoKSB8fCBpZ25vcmVkSG9va3MoaG9vay50aXRsZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbGx1cmUuc3RhcnRDYXNlKGhvb2sudGl0bGUpXG4gICAgfVxuXG4gICAgb25Ib29rRW5kKGhvb2spIHtcbiAgICAgICAgaWYgKCF0aGlzLmFsbHVyZS5nZXRDdXJyZW50U3VpdGUoKSB8fCBpZ25vcmVkSG9va3MoaG9vay50aXRsZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbGx1cmUuZW5kQ2FzZSh0ZXN0U3RhdHVzZXMuUEFTU0VEKVxuXG4gICAgICAgIGlmICh0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpLnN0ZXBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5hbGx1cmUuZ2V0Q3VycmVudFN1aXRlKCkudGVzdGNhc2VzLnBvcCgpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRTdG9yeSh7c3RvcnlOYW1lfSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRlc3QgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG4gICAgICAgIHRlc3QuYWRkTGFiZWwoJ3N0b3J5Jywgc3RvcnlOYW1lKVxuICAgIH1cblxuICAgIGFkZEZlYXR1cmUoe2ZlYXR1cmVOYW1lfSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRlc3QgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG4gICAgICAgIHRlc3QuYWRkTGFiZWwoJ2ZlYXR1cmUnLCBmZWF0dXJlTmFtZSlcbiAgICB9XG5cbiAgICBhZGRTZXZlcml0eSh7c2V2ZXJpdHl9KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FueVRlc3RSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGVzdCA9IHRoaXMuYWxsdXJlLmdldEN1cnJlbnRUZXN0KClcbiAgICAgICAgdGVzdC5hZGRMYWJlbCgnc2V2ZXJpdHknLCBzZXZlcml0eSlcbiAgICB9XG5cbiAgICBhZGRJc3N1ZSh7aXNzdWV9KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FueVRlc3RSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGVzdCA9IHRoaXMuYWxsdXJlLmdldEN1cnJlbnRUZXN0KClcbiAgICAgICAgdGVzdC5hZGRMYWJlbCgnaXNzdWUnLCBpc3N1ZSlcbiAgICB9XG5cbiAgICBhZGRUZXN0SWQoe3Rlc3RJZH0pIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQW55VGVzdFJ1bm5pbmcoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0ZXN0ID0gdGhpcy5hbGx1cmUuZ2V0Q3VycmVudFRlc3QoKVxuICAgICAgICB0ZXN0LmFkZExhYmVsKCd0ZXN0SWQnLCB0ZXN0SWQpXG4gICAgfVxuXG4gICAgYWRkRW52aXJvbm1lbnQoe25hbWUsIHZhbHVlfSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNBbnlUZXN0UnVubmluZygpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRlc3QgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG4gICAgICAgIHRlc3QuYWRkUGFyYW1ldGVyKCdlbnZpcm9ubWVudC12YXJpYWJsZScsIG5hbWUsIHZhbHVlKVxuICAgIH1cblxuICAgIGFkZERlc2NyaXB0aW9uKHtkZXNjcmlwdGlvbiwgdHlwZX0pIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQW55VGVzdFJ1bm5pbmcoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0ZXN0ID0gdGhpcy5hbGx1cmUuZ2V0Q3VycmVudFRlc3QoKVxuICAgICAgICB0ZXN0LnNldERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCB0eXBlKVxuICAgIH1cblxuICAgIGFkZEF0dGFjaG1lbnQoe25hbWUsIGNvbnRlbnQsIHR5cGUgPSAndGV4dC9wbGFpbid9KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FueVRlc3RSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGUgPT09ICdhcHBsaWNhdGlvbi9qc29uJykge1xuICAgICAgICAgICAgdGhpcy5kdW1wSlNPTihuYW1lLCBjb250ZW50KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hbGx1cmUuYWRkQXR0YWNobWVudChuYW1lLCBCdWZmZXIuZnJvbShjb250ZW50KSwgdHlwZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFN0ZXAoe3N0ZXB9KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FueVRlc3RSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbGx1cmUuc3RhcnRTdGVwKHN0ZXAudGl0bGUpXG4gICAgICAgIGlmIChzdGVwLmF0dGFjaG1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkQXR0YWNobWVudChzdGVwLmF0dGFjaG1lbnQpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hbGx1cmUuZW5kU3RlcChzdGVwLnN0YXR1cylcbiAgICB9XG5cbiAgICBhZGRBcmd1bWVudCh7bmFtZSwgdmFsdWV9KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0FueVRlc3RSdW5uaW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRlc3QgPSB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG4gICAgICAgIHRlc3QuYWRkUGFyYW1ldGVyKCdhcmd1bWVudCcsIG5hbWUsIHZhbHVlKVxuICAgIH1cblxuICAgIGlzQW55VGVzdFJ1bm5pbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFsbHVyZS5nZXRDdXJyZW50U3VpdGUoKSAmJiB0aGlzLmFsbHVyZS5nZXRDdXJyZW50VGVzdCgpXG4gICAgfVxuXG4gICAgaXNTY3JlZW5zaG90Q29tbWFuZChjb21tYW5kKXtcbiAgICAgICAgY29uc3QgaXNTY3JlbnNob3RFbmRwb2ludCA9IC9cXC9zZXNzaW9uXFwvW14vXSpcXC9zY3JlZW5zaG90L1xuICAgICAgICByZXR1cm4gaXNTY3JlbnNob3RFbmRwb2ludC50ZXN0KGNvbW1hbmQuZW5kcG9pbnQpXG4gICAgfVxuXG4gICAgZHVtcEpTT04obmFtZSwganNvbikge1xuICAgICAgICB0aGlzLmFsbHVyZS5hZGRBdHRhY2htZW50KG5hbWUsIEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gZmVhdHVyZSB0byB0ZXN0XG4gICAgICogQHBhcmFtIHsoc3RyaW5nKX0gZmVhdHVyZU5hbWUgLSBmZWF0dXJlIG5hbWUgb3IgYW4gYXJyYXkgb2YgbmFtZXNcbiAgICAgKi9cbiAgICBzdGF0aWMgYWRkRmVhdHVyZSA9IChmZWF0dXJlTmFtZSkgPT4ge1xuICAgICAgICB0ZWxsUmVwb3J0ZXIoZXZlbnRzLmFkZEZlYXR1cmUsIHtmZWF0dXJlTmFtZX0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWduIHNldmVyaXR5IHRvIHRlc3RcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2V2ZXJpdHkgLSBzZXZlcml0eSB2YWx1ZVxuICAgICAqL1xuICAgIHN0YXRpYyBhZGRTZXZlcml0eSA9IChzZXZlcml0eSkgPT4ge1xuICAgICAgICB0ZWxsUmVwb3J0ZXIoZXZlbnRzLmFkZFNldmVyaXR5LCB7c2V2ZXJpdHl9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFzc2lnbiBpc3N1ZSBpZCB0byB0ZXN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlzc3VlIC0gaXNzdWUgaWQgdmFsdWVcbiAgICAgKi9cbiAgICBzdGF0aWMgYWRkSXNzdWUgPSAoaXNzdWUpID0+IHtcbiAgICAgICAgdGVsbFJlcG9ydGVyKGV2ZW50cy5hZGRJc3N1ZSwge2lzc3VlfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBc3NpZ24gVE1TIHRlc3QgaWQgdG8gdGVzdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXN0SWQgLSB0ZXN0IGlkIHZhbHVlXG4gICAgICovXG4gICAgc3RhdGljIGFkZFRlc3RJZCA9ICh0ZXN0SWQpID0+IHtcbiAgICAgICAgdGVsbFJlcG9ydGVyKGV2ZW50cy5hZGRUZXN0SWQsIHt0ZXN0SWR9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFzc2lnbiBzdG9yeSB0byB0ZXN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHN0b3J5TmFtZSAtIHN0b3J5IG5hbWUgZm9yIHRlc3RcbiAgICAgKi9cbiAgICBzdGF0aWMgYWRkU3RvcnkgPSAoc3RvcnlOYW1lKSA9PiB7XG4gICAgICAgIHRlbGxSZXBvcnRlcihldmVudHMuYWRkU3RvcnksIHtzdG9yeU5hbWV9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBlbnZpcm9ubWVudCB2YWx1ZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gZW52aXJvbm1lbnQgbmFtZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIGVudmlyb25tZW50IHZhbHVlXG4gICAgICovXG4gICAgc3RhdGljIGFkZEVudmlyb25tZW50ID0gKG5hbWUsIHZhbHVlKSA9PiB7XG4gICAgICAgIHRlbGxSZXBvcnRlcihldmVudHMuYWRkRW52aXJvbm1lbnQsIHtuYW1lLCB2YWx1ZX0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXNzaWduIHRlc3QgZGVzY3JpcHRpb24gdG8gdGVzdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkZXNjcmlwdGlvbiAtIGRlc2NyaXB0aW9uIGZvciB0ZXN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBkZXNjcmlwdGlvbiB0eXBlICd0ZXh0J1xcJ2h0bWwnXFwnbWFya2Rvd24nXG4gICAgICovXG4gICAgc3RhdGljIGFkZERlc2NyaXB0aW9uID0gKGRlc2NyaXB0aW9uLCB0eXBlKSA9PiB7XG4gICAgICAgIHRlbGxSZXBvcnRlcihldmVudHMuYWRkRGVzY3JpcHRpb24sIHtkZXNjcmlwdGlvbiwgdHlwZX0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGF0dGFjaG1lbnRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIGF0dGFjaG1lbnQgZmlsZSBuYW1lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRlbnQgLSBhdHRhY2htZW50IGNvbnRlbnRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3R5cGU9J3RleHQvcGxhaW4nXSAtIGF0dGFjaG1lbnQgbWltZSB0eXBlXG4gICAgICovXG4gICAgc3RhdGljIGFkZEF0dGFjaG1lbnQgPSAobmFtZSwgY29udGVudCwgdHlwZSA9ICd0ZXh0L3BsYWluJykgPT4ge1xuICAgICAgICB0ZWxsUmVwb3J0ZXIoZXZlbnRzLmFkZEF0dGFjaG1lbnQsIHtuYW1lLCBjb250ZW50LCB0eXBlfSlcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFsbHVyZSBzdGVwXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRpdGxlIC0gc3RlcCBuYW1lIGluIHJlcG9ydFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhdHRhY2htZW50T2JqZWN0IC0gYXR0YWNobWVudCBmb3Igc3RlcFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRhY2htZW50T2JqZWN0LmNvbnRlbnQgLSBhdHRhY2htZW50IGNvbnRlbnRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2F0dGFjaG1lbnRPYmplY3QubmFtZT0nYXR0YWNobWVudCddIC0gYXR0YWNobWVudCBuYW1lXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtzdGF0dXM9J3Bhc3NlZCddIC0gc3RlcCBzdGF0dXNcbiAgICAgKi9cbiAgICBzdGF0aWMgYWRkU3RlcCA9ICh0aXRsZSwge2NvbnRlbnQsIG5hbWUgPSAnYXR0YWNobWVudCd9LCBzdGF0dXMgPSBzdGVwU3RhdHVzZXMuUEFTU0VEKSA9PiB7XG4gICAgICAgIGlmICghT2JqZWN0LnZhbHVlcyhzdGVwU3RhdHVzZXMpLmluY2x1ZGVzKHN0YXR1cykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU3RlcCBzdGF0dXMgbXVzdCBiZSAke09iamVjdC52YWx1ZXMoc3RlcFN0YXR1c2VzKS5qb2luKCcgb3IgJyl9LiBZb3UgdHJpZWQgdG8gc2V0IFwiJHtzdGF0dXN9XCJgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RlcCA9IHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0YXR1c1xuICAgICAgICB9XG4gICAgICAgIHRlbGxSZXBvcnRlcihldmVudHMuYWRkU3RlcCwge3N0ZXB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhZGRpdGlvbmFsIGFyZ3VtZW50IHRvIHRlc3RcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIGFyZ3VtZW50IG5hbWVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBhcmd1bWVudCB2YWx1ZVxuICAgICAqL1xuICAgIHN0YXRpYyBhZGRBcmd1bWVudCA9IChuYW1lLCB2YWx1ZSkgPT4ge1xuICAgICAgICB0ZWxsUmVwb3J0ZXIoZXZlbnRzLmFkZEFyZ3VtZW50LCB7bmFtZSwgdmFsdWV9KVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQWxsdXJlUmVwb3J0ZXJcbiJdfQ==